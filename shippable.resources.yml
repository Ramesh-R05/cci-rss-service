# This resources are only used for Lsitings Service

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################

resources:

  # Docker Image Options to run the container
  - name: rss-service-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 128
      portMappings:
        - 0:3000
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "rss-service"

  # MASTER Docker Image for the rss service
  - name: rss-service-img-master
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/rss-service"
    seed:
      versionName: latest

  # Feature BRANCH Docker Image for the rss service
  - name: rss-service-img-branch
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/rss-service"
    seed:
      versionName: latest

  # Lsiting Service Github repo
  - name: rss-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/rss-service
      branch: master

  # Slack connection
  - name: rss-slack-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"

  # Seed Release version
    # for Rollback refer to below URL
    # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: rss-service-version
    type: version
    seed:
      versionName: "1.0.0"

  ####################################
  # NON PROD environment configuration
  ####################################

  # AWS Non Prod Cluster
  - name: rss-service-env-sit-ecs
    type: cluster
    integration: AWS-digital-nonprod
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  # AWS SIT load Balancer - rss - MASTER branch
  - name: rss-service-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/rss-service-sit/9b86f915aaad6e8c"
      method: application

  # AWS SIT:8080 load Balancer - rss service - feature BRANCH
  - name: rss-service-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/rss-service-branch-sit/de8d91b36695f763"
      method: application

  # AWS TEST load Balancer - rss service SIT - MASTER branch
  - name: rss-service-params-sit
    type: params
    version:
      params:
        NODE_ENV: "dev"
        APP_ENV: "sit"
        APM_KEY: "d182e4391d2b340c7ae190bcb7a24b754f148ec4"

  ####################################
  # PROD environment configuration
  ####################################

  # AWS Non Prod Cluster
  - name: rss-service-env-prod-ecs
    type: cluster
    integration: AWS-digital-prod
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  # AWS PROD load Balancer - rss service PROD - MASTER branch
  - name: rss-service-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/rss-service-prod/35e44a14a1fc3422"
      method: application

  # PROD parameters
  - name: rss-service-params-prod
    type: params
    version:
      params:
        NODE_ENV: "production"
        APP_ENV: "production"
        APM_KEY: "d182e4391d2b340c7ae190bcb7a24b754f148ec4"